
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DayBalancer · Find a Time</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --primary: #1B6896;
    --primary-dark: #154F74;
    --primary-light: #E8F2F9;
    --green: #4CAF7D;
    --green-light: #E8F5EE;
    --orange: #E8732A;
    --light: #F5F7FA;
    --border: #DCE3EA;
    --dark: #2C3A47;
    --muted: #6B7C8D;
    --white: #FFFFFF;
  }

  body {
    font-family: 'Nunito Sans', 'Segoe UI', sans-serif;
    background: var(--light);
    color: var(--dark);
    min-height: 100vh;
    -webkit-user-select: none;
    user-select: none;
  }

  /* HEADER */
  .header {
    background: var(--primary);
    padding: 14px 28px;
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .logo { font-size: 22px; font-weight: 800; color: white; letter-spacing: -0.3px; }
  .logo span { color: #ffffff; font-weight: 400; }
  .tagline { font-size: 11px; color: rgba(255,255,255,0.7); text-transform: uppercase; letter-spacing: 0.05em; }
  .header-right { margin-left: auto; display: flex; align-items: center; gap: 10px; }

  /* CARDS */
  .card {
    background: var(--white);
    border-radius: 12px;
    border: 1px solid var(--border);
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    padding: 28px;
  }

  /* BUTTONS */
  .btn {
    display: inline-block;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 11px 22px;
    font-size: 14px;
    font-weight: 700;
    cursor: pointer;
    font-family: inherit;
    letter-spacing: 0.01em;
    transition: background 0.15s, opacity 0.15s;
    white-space: nowrap;
  }
  .btn:hover { background: var(--primary-dark); }
  .btn-outline {
    background: var(--white);
    color: var(--dark);
    border: 1.5px solid var(--border);
  }
  .btn-outline:hover { background: var(--light); }
  .btn-green { background: var(--green); }
  .btn-green:hover { background: #3d9e6a; }
  .btn-full { width: 100%; }
  .btn-sm { padding: 8px 14px; font-size: 13px; }

  /* INPUTS */
  .input {
    width: 100%;
    border: 1.5px solid var(--border);
    border-radius: 8px;
    padding: 11px 16px;
    font-size: 15px;
    font-family: inherit;
    color: var(--dark);
    background: var(--white);
    outline: none;
    transition: border-color 0.15s;
  }
  .input:focus { border-color: var(--primary); }

  label.field-label {
    display: block;
    font-size: 12px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--muted);
    margin-bottom: 6px;
  }

  .section-title {
    font-size: 26px;
    font-weight: 800;
    color: var(--dark);
    margin-bottom: 8px;
  }

  /* CHIPS */
  .chip {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    border-radius: 20px;
    padding: 4px 12px;
    font-size: 12px;
    font-weight: 700;
  }
  .chip-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  /* VIEWS */
  .view { display: none; }
  .view.active { display: block; }

  /* HOME */
  .home-body { max-width: 520px; margin: 64px auto; padding: 0 24px; }
  .home-lead { font-size: 40px; font-weight: 800; line-height: 1.1; margin-bottom: 16px; }
  .home-sub { color: var(--muted); font-size: 16px; line-height: 1.6; margin-bottom: 40px; }
  .home-btns { display: flex; flex-direction: column; gap: 14px; }
  .home-chips { margin-top: 48px; display: flex; gap: 10px; flex-wrap: wrap; }

  /* CREATE / JOIN */
  .form-body { max-width: 480px; margin: 48px auto; padding: 0 24px; }
  .back-btn { background: none; border: none; cursor: pointer; font-size: 20px; color: white; padding: 0; }
  .error-msg { color: #E8418D; font-size: 14px; margin-top: 8px; }

  /* GRID VIEW */
  .grid-body { max-width: 900px; margin: 0 auto; padding: 24px; }
  .grid-top { display: flex; gap: 12px; align-items: flex-end; margin-bottom: 20px; flex-wrap: wrap; }
  .grid-top .name-field { flex: 1; min-width: 200px; }
  .grid-top .btn-row { display: flex; gap: 10px; flex-wrap: wrap; }
  .grid-hint { color: var(--muted); font-size: 14px; margin-bottom: 16px; }
  .grid-wrap { overflow-x: auto; }

  .time-grid {
    display: grid;
    grid-template-columns: 56px repeat(7, 1fr);
    gap: 2px;
    min-width: 560px;
  }
  .grid-header { text-align: center; font-weight: 700; font-size: 13px; padding: 8px 0; letter-spacing: 0.04em; }
  .time-label { font-size: 11px; color: var(--muted); text-align: right; padding-right: 8px; padding-top: 4px; line-height: 28px; }
  .slot {
    height: 28px;
    border-radius: 4px;
    background: #EEF2F6;
    border: 1.5px solid transparent;
    cursor: pointer;
    transition: background 0.08s;
  }
  .slot.selected {
    background: var(--green);
    border-color: rgba(0,0,0,0.15);
  }
  .slot.overlap-1 { background: #C8E6C9; border-color: rgba(0,0,0,0.1); }
  .slot.overlap-2 { background: #81C784; border-color: rgba(0,0,0,0.1); }
  .slot.overlap-3 { background: var(--green); border-color: rgba(0,0,0,0.1); }
  .slot.overlap-4 { background: #1B88B8; border-color: rgba(0,0,0,0.1); }
  .slot.overlap-all { background: var(--primary); border-color: rgba(0,0,0,0.15); }

  .responded-section { margin-top: 20px; }
  .responded-chips { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px; }

  /* RESULTS */
  .results-body {
    max-width: 960px;
    margin: 0 auto;
    padding: 24px;
    display: grid;
    grid-template-columns: 1fr 280px;
    gap: 24px;
  }
  @media (max-width: 700px) {
    .results-body { grid-template-columns: 1fr; }
  }
  .results-title { font-size: 26px; font-weight: 800; margin-bottom: 4px; }
  .results-sub { color: var(--muted); font-size: 14px; margin-bottom: 20px; }

  .legend { display: flex; gap: 12px; margin-top: 16px; flex-wrap: wrap; }
  .legend-item { display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--muted); }
  .legend-swatch { width: 16px; height: 16px; border-radius: 3px; border: 1px solid rgba(0,0,0,0.1); }

  .sidebar { display: flex; flex-direction: column; gap: 16px; }
  .sidebar-title { font-size: 18px; font-weight: 800; margin-bottom: 14px; }

  .best-slot {
    margin-bottom: 10px;
    padding: 10px 12px;
    background: var(--light);
    border-radius: 8px;
    border: 1px solid var(--border);
  }
  .best-slot-title { font-weight: 700; font-size: 14px; }
  .best-slot-names { font-size: 12px; color: var(--muted); margin-top: 2px; }
  .best-slot-bar { margin-top: 6px; height: 4px; border-radius: 2px; background: #EEF2F6; overflow: hidden; }
  .best-slot-fill { height: 100%; border-radius: 2px; background: var(--green); }
  .best-slot-fill.full { background: var(--primary); }

  .participant-row { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
  .participant-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
  .participant-name { font-size: 14px; font-weight: 600; }
  .participant-slots { font-size: 12px; color: var(--muted); margin-left: auto; }

  .share-card {
    background: var(--primary);
    border-radius: 12px;
    padding: 20px;
    border: none;
  }
  .share-card p { color: white; font-size: 14px; font-weight: 700; margin-bottom: 10px; }
  .share-code {
    background: white;
    border-radius: 8px;
    padding: 10px 14px;
    font-size: 16px;
    font-weight: 800;
    letter-spacing: 0.05em;
    text-align: center;
    margin-bottom: 10px;
    color: var(--dark);
  }

  .no-data { color: var(--muted); font-size: 14px; }

  /* CODE BADGE in header */
  .code-badge {
    font-size: 13px;
    font-weight: 700;
    background: rgba(255,255,255,0.95);
    color: var(--primary-dark);
    border: none;
    border-radius: 8px;
    padding: 6px 12px;
    cursor: pointer;
    font-family: inherit;
    transition: background 0.15s;
  }
  .code-badge:hover { background: white; }
  .code-badge.copied { background: var(--green); color: white; }
</style>
</head>
<body>

<!-- ══════════ HOME ══════════ -->
<div id="view-home" class="view active">
  <div class="header">
    <div>
      <div class="logo">Day<span>Balancer</span></div>
      <div class="tagline">Find a time · Together</div>
    </div>
  </div>
  <div class="home-body">
    <h1 class="home-lead">Find a time that<br>works for everyone</h1>
    <p class="home-sub">Create a session, share the code, and invite others to mark when they're available. Simple, fast, and clear.</p>
    <div class="home-btns">
      <button class="btn btn-full" style="padding:16px;font-size:16px;" onclick="showView('create')">+ Create a new session</button>
      <button class="btn btn-outline btn-full" style="padding:16px;font-size:16px;" onclick="showView('join')">Join with a code</button>
    </div>
    <div class="home-chips">
      <span class="chip" style="background:#E8F2F9;border:1px solid #1B6896;color:#154F74;">No sign-up needed</span>
      <span class="chip" style="background:#E8F5EE;border:1px solid #3d9e6a;color:#2d7a52;">Works across time zones</span>
      <span class="chip" style="background:#FDF0E8;border:1px solid #c45e1a;color:#9a4a12;">See who's free at a glance</span>
    </div>
  </div>
</div>

<!-- ══════════ CREATE ══════════ -->
<div id="view-create" class="view">
  <div class="header">
    <button class="back-btn" onclick="showView('home')">←</button>
    <div>
      <div class="logo">Day<span>Balancer</span></div>
    </div>
  </div>
  <div class="form-body">
    <div class="card">
      <h2 class="section-title" style="margin-bottom:24px;">Name your session</h2>
      <div style="margin-bottom:20px;">
        <label class="field-label">What are you scheduling?</label>
        <input id="session-title-input" class="input" placeholder="e.g. Team check-in, Coffee chat, Sprint planning..." onkeydown="if(event.key==='Enter') createSession()">
      </div>
      <button class="btn btn-full" onclick="createSession()">Create session →</button>
    </div>
  </div>
</div>

<!-- ══════════ JOIN ══════════ -->
<div id="view-join" class="view">
  <div class="header">
    <button class="back-btn" onclick="showView('home')">←</button>
    <div><div class="logo">Day<span>Balancer</span></div></div>
  </div>
  <div class="form-body">
    <div class="card">
      <h2 class="section-title" style="margin-bottom:24px;">Join a session</h2>
      <div style="margin-bottom:20px;">
        <label class="field-label">Session code</label>
        <input id="join-code-input" class="input" placeholder="e.g. oak-river-247" onkeydown="if(event.key==='Enter') joinSession()">
        <p id="join-error" class="error-msg" style="display:none;"></p>
      </div>
      <button class="btn btn-full" onclick="joinSession()">Join →</button>
    </div>
  </div>
</div>

<!-- ══════════ ENTER AVAILABILITY ══════════ -->
<div id="view-enter" class="view">
  <div class="header">
    <div>
      <div class="logo">Day<span>Balancer</span></div>
      <div class="tagline" id="enter-session-label"></div>
    </div>
    <div class="header-right">
      <button id="enter-code-badge" class="code-badge" onclick="copyCode('enter-code-badge')"></button>
      <button class="btn btn-sm" style="background:rgba(255,255,255,0.95);color:var(--primary-dark);" onclick="showResults()">View results</button>
    </div>
  </div>
  <div class="grid-body">
    <div class="grid-top">
      <div class="name-field">
        <label class="field-label">Your name</label>
        <input id="participant-name-input" class="input" placeholder="How should we call you?">
      </div>
      <div class="btn-row">
        <button class="btn btn-green" onclick="submitAvailability()">Save my availability →</button>
      </div>
    </div>
    <p class="grid-hint">Click and drag to mark when you're free. <strong>Green = available.</strong></p>
    <div class="grid-wrap">
      <div class="time-grid" id="enter-grid"></div>
    </div>
    <div class="responded-section" id="responded-section" style="display:none;">
      <label class="field-label">Already responded</label>
      <div class="responded-chips" id="responded-chips"></div>
    </div>
  </div>
</div>

<!-- ══════════ RESULTS ══════════ -->
<div id="view-results" class="view">
  <div class="header">
    <div>
      <div class="logo">Day<span>Balancer</span></div>
      <div class="tagline" id="results-session-label"></div>
    </div>
    <div class="header-right">
      <button id="results-code-badge" class="code-badge" onclick="copyCode('results-code-badge')"></button>
      <button class="btn btn-sm" onclick="goAddAvailability()">+ Add my availability</button>
    </div>
  </div>
  <div class="results-body">
    <div>
      <h2 class="results-title">Availability overview</h2>
      <p class="results-sub" id="results-sub"></p>
      <div class="grid-wrap">
        <div class="time-grid" id="results-grid"></div>
      </div>
      <div class="legend">
        <div class="legend-item"><div class="legend-swatch" style="background:#EEF2F6;"></div> No one</div>
        <div class="legend-item"><div class="legend-swatch" style="background:#C8E6C9;"></div> Some</div>
        <div class="legend-item"><div class="legend-swatch" style="background:#81C784;"></div> Many</div>
        <div class="legend-item"><div class="legend-swatch" style="background:var(--green);"></div> Most</div>
        <div class="legend-item"><div class="legend-swatch" style="background:var(--primary);"></div> Everyone</div>
      </div>
    </div>
    <div class="sidebar">
      <div class="card">
        <div class="sidebar-title">Best times</div>
        <div id="best-times-list"></div>
      </div>
      <div class="card">
        <div class="sidebar-title">Who's responded</div>
        <div id="participants-list"></div>
      </div>
      <div class="share-card">
        <p>Invite others to share their availability</p>
        <div class="share-code" id="share-code-display"></div>
        <button id="share-copy-btn" class="btn btn-outline btn-full btn-sm" style="color:var(--dark);" onclick="copyCode('share-copy-btn')">Copy session code</button>
      </div>
    </div>
  </div>
</div>

<script>
// ══════════════════════════════════════════════
// DATA
// ══════════════════════════════════════════════
const DAYS = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
const HOURS = Array.from({length:14},(_,i)=>i+7); // 7am-8pm
const PARTICIPANT_COLORS = [
  "#1B6896","#4CAF7D","#E8732A","#2A8FA8",
  "#7B68EE","#E8418D","#F5A623","#52B788","#4A90D9"
];

let sessions = {};
let currentCode = null;
let selectedSlots = new Set();
let isDragging = false;
let dragMode = null; // "add" | "remove"

// ── Storage ──────────────────────────────────
async function loadSessions() {
  try {
    if (window.storage) {
      const r = await window.storage.get("db-findatime-sessions");
      if (r) sessions = JSON.parse(r.value);
    } else {
      const s = localStorage.getItem("db-findatime-sessions");
      if (s) sessions = JSON.parse(s);
    }
  } catch(e) {}
}
async function saveSessions() {
  try {
    const data = JSON.stringify(sessions);
    if (window.storage) await window.storage.set("db-findatime-sessions", data);
    else localStorage.setItem("db-findatime-sessions", data);
  } catch(e) {}
}

// ── Helpers ──────────────────────────────────
function generateCode() {
  const w = ["oak","river","bloom","sky","stone","moss","tide","grove","glow","dawn","leaf","creek"];
  const pick = () => w[Math.floor(Math.random()*w.length)];
  return `${pick()}-${pick()}-${Math.floor(100+Math.random()*900)}`;
}
function formatHour(h) {
  if(h===12) return "12 pm";
  if(h>12) return `${h-12} pm`;
  return `${h} am`;
}
function slotKey(day,hour) { return `${day}-${hour}`; }
function currentSession() { return sessions[currentCode] || null; }

// ── Views ─────────────────────────────────────
function showView(name) {
  document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
  document.getElementById(`view-${name}`).classList.add('active');
}

// ── Create ────────────────────────────────────
function createSession() {
  const title = document.getElementById('session-title-input').value.trim();
  if (!title) return;
  const code = generateCode();
  sessions[code] = { code, title, participants: [] };
  saveSessions();
  currentCode = code;
  selectedSlots = new Set();
  openEnterView();
}

// ── Join ─────────────────────────────────────
function joinSession() {
  const code = document.getElementById('join-code-input').value.trim().toLowerCase();
  const err = document.getElementById('join-error');
  if (sessions[code]) {
    currentCode = code;
    selectedSlots = new Set();
    err.style.display = 'none';
    openEnterView();
  } else {
    err.textContent = "We couldn't find that session. Double-check the code.";
    err.style.display = 'block';
  }
}

// ── Enter view ───────────────────────────────
function openEnterView() {
  const s = currentSession();
  document.getElementById('enter-session-label').textContent = s.title;
  document.getElementById('enter-code-badge').textContent = currentCode;
  document.getElementById('participant-name-input').value = '';
  buildEnterGrid();
  updateRespondedSection();
  showView('enter');
}

function buildEnterGrid() {
  const grid = document.getElementById('enter-grid');
  grid.innerHTML = '';
  // Header
  grid.appendChild(makeEl('div',''));
  DAYS.forEach(d => {
    const h = makeEl('div', d, 'grid-header');
    grid.appendChild(h);
  });
  // Rows
  HOURS.forEach(h => {
    const lbl = makeEl('div', formatHour(h), 'time-label');
    grid.appendChild(lbl);
    DAYS.forEach(d => {
      const key = slotKey(d,h);
      const cell = makeEl('div','','slot');
      if (selectedSlots.has(key)) cell.classList.add('selected');
      cell.addEventListener('mousedown', e => { e.preventDefault(); dragMode = !selectedSlots.has(key) ? 'add' : 'remove'; isDragging = true; toggleSlot(cell, key); });
      cell.addEventListener('mouseenter', () => { if(isDragging) toggleSlot(cell, key); });
      grid.appendChild(cell);
    });
  });
}

function toggleSlot(cell, key) {
  if (dragMode === 'add') { selectedSlots.add(key); cell.classList.add('selected'); }
  else { selectedSlots.delete(key); cell.classList.remove('selected'); }
}

function updateRespondedSection() {
  const s = currentSession();
  const sec = document.getElementById('responded-section');
  const chips = document.getElementById('responded-chips');
  if (!s || s.participants.length === 0) { sec.style.display = 'none'; return; }
  sec.style.display = 'block';
  chips.innerHTML = '';
  s.participants.forEach(p => {
    const chip = makeEl('span', `<span class="chip-dot" style="background:${p.color};"></span>${p.name}`, 'chip');
    chip.style.cssText = `background:${p.color}18;border:1px solid ${p.color}44;color:var(--dark);`;
    chips.appendChild(chip);
  });
}

function submitAvailability() {
  const name = document.getElementById('participant-name-input').value.trim();
  if (!name) { document.getElementById('participant-name-input').focus(); return; }
  const s = currentSession();
  const color = PARTICIPANT_COLORS[s.participants.length % PARTICIPANT_COLORS.length];
  const participant = { name, slots: Array.from(selectedSlots), color };
  sessions[currentCode].participants.push(participant);
  saveSessions();
  showResults();
}

// ── Results view ─────────────────────────────
function showResults() {
  const s = currentSession();
  if (!s) return;
  document.getElementById('results-session-label').textContent = s.title;
  document.getElementById('results-code-badge').textContent = currentCode;
  document.getElementById('share-code-display').textContent = currentCode;
  const total = s.participants.length;
  document.getElementById('results-sub').textContent =
    `${total} ${total===1?'person has':'people have'} responded. Darker = more people free.`;
  buildResultsGrid(s);
  buildBestTimes(s);
  buildParticipantsList(s);
  showView('results');
}

function buildResultsGrid(s) {
  const grid = document.getElementById('results-grid');
  grid.innerHTML = '';
  const total = s.participants.length;
  // Build overlap map
  const map = {};
  s.participants.forEach(p => p.slots.forEach(slot => {
    if (!map[slot]) map[slot] = [];
    map[slot].push(p);
  }));
  // Header
  grid.appendChild(makeEl('div',''));
  DAYS.forEach(d => grid.appendChild(makeEl('div', d, 'grid-header')));
  // Rows
  HOURS.forEach(h => {
    grid.appendChild(makeEl('div', formatHour(h), 'time-label'));
    DAYS.forEach(d => {
      const key = slotKey(d,h);
      const ps = map[key] || [];
      const cell = makeEl('div','','slot');
      const ratio = total > 0 ? ps.length / total : 0;
      if (ps.length === 0) cell.style.background = '#EEF2F6';
      else if (ratio >= 1) { cell.style.background = 'var(--primary)'; cell.style.borderColor = 'rgba(0,0,0,0.15)'; }
      else if (ratio >= 0.66) { cell.style.background = 'var(--green)'; cell.style.borderColor = 'rgba(0,0,0,0.1)'; }
      else if (ratio >= 0.33) { cell.style.background = '#81C784'; cell.style.borderColor = 'rgba(0,0,0,0.1)'; }
      else { cell.style.background = '#C8E6C9'; cell.style.borderColor = 'rgba(0,0,0,0.08)'; }
      if (ps.length > 0) cell.title = ps.map(p=>p.name).join(', ');
      grid.appendChild(cell);
    });
  });
}

function buildBestTimes(s) {
  const list = document.getElementById('best-times-list');
  list.innerHTML = '';
  const total = s.participants.length;
  if (total === 0) { list.innerHTML = '<p class="no-data">Add more people to find overlaps.</p>'; return; }
  const map = {};
  s.participants.forEach(p => p.slots.forEach(slot => {
    if (!map[slot]) map[slot] = [];
    map[slot].push(p);
  }));
  const sorted = Object.entries(map)
    .filter(([,ps]) => ps.length > 1)
    .sort((a,b) => b[1].length - a[1].length)
    .slice(0,5);
  if (sorted.length === 0) { list.innerHTML = '<p class="no-data">No shared availability yet.</p>'; return; }
  sorted.forEach(([key, ps]) => {
    const [day, hour] = key.split('-');
    const div = document.createElement('div');
    div.className = 'best-slot';
    const pct = Math.round((ps.length/total)*100);
    div.innerHTML = `
      <div class="best-slot-title">${day} · ${formatHour(parseInt(hour))}</div>
      <div class="best-slot-names">${ps.map(p=>p.name).join(', ')} (${ps.length}/${total})</div>
      <div class="best-slot-bar"><div class="best-slot-fill ${ps.length===total?'full':''}" style="width:${pct}%;"></div></div>`;
    list.appendChild(div);
  });
}

function buildParticipantsList(s) {
  const list = document.getElementById('participants-list');
  list.innerHTML = '';
  if (s.participants.length === 0) { list.innerHTML = '<p class="no-data">No responses yet.</p>'; return; }
  s.participants.forEach(p => {
    const row = document.createElement('div');
    row.className = 'participant-row';
    row.innerHTML = `<div class="participant-dot" style="background:${p.color};"></div><span class="participant-name">${p.name}</span><span class="participant-slots">${p.slots.length} slots</span>`;
    list.appendChild(row);
  });
}

function goAddAvailability() {
  selectedSlots = new Set();
  openEnterView();
}

// ── Copy code ─────────────────────────────────
function copyCode(btnId) {
  const btn = document.getElementById(btnId);
  navigator.clipboard.writeText(currentCode).catch(()=>{});
  const orig = btn.textContent;
  btn.textContent = '✓ Copied!';
  btn.classList.add('copied');
  setTimeout(() => { btn.textContent = btnId === 'share-copy-btn' ? 'Copy session code' : currentCode; btn.classList.remove('copied'); }, 2000);
}

// ── Util ──────────────────────────────────────
function makeEl(tag, html, cls) {
  const el = document.createElement(tag);
  if (cls) el.className = cls;
  el.innerHTML = html;
  return el;
}

// ── Global mouse up ───────────────────────────
document.addEventListener('mouseup', () => isDragging = false);

// ── Init ──────────────────────────────────────
loadSessions().then(() => {
  // Check URL hash for direct session link
  const hash = location.hash.replace('#','');
  if (hash && sessions[hash]) {
    currentCode = hash;
    selectedSlots = new Set();
    openEnterView();
  }
});
</script>
</body>
</html>
